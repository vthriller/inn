#! /bin/sh
##  $Revision$
##  Script to make INN directories.

PATHNEWS=@prefix@
PATHBIN=${PATHNEWS}/bin
PATHETC=${PATHNEWS}/etc
PATHCONTROL=${PATHBIN}/control
PATHFILTER=${PATHBIN}/filter
PATHRUN=${PATHNEWS}/run
PATHLOG=${PATHNEWS}/log
PATHDB=${PATHNEWS}/db
PATHSPOOL=${PATHNEWS}/spool
PATHARTICLES=${PATHSPOOL}/articles
PATHOVERVIEW=${PATHSPOOL}/overview
PATHOUTGOING=${PATHSPOOL}/outgoing
PATHINCOMING=${PATHSPOOL}/incoming
PATHARCHIVE=${PATHSPOOL}/archive
PATHMAN=${PATHNEWS}/man
PATHTMP=${PATHNEWS}/tmp

##  Some systems don't support -x, so we have to use -f.
CHOWN=chown
if [ ${CHOWN} = chown ] ; then
    if [ -f /sbin/chown ] ; then
	CHOWN=/sbin/chown
    else
	if [ -f /etc/chown ] ; then
	    CHOWN=/etc/chown
	else
	    if [ -f /usr/etc/chown ] ; then
		CHOWN=/usr/etc/chown
	    fi
	fi
    fi
fi

MAN1=${PATHMAN}/man1
MAN3=${PATHMAN}/man3
MAN5=${PATHMAN}/man5
MAN8=${PATHMAN}/man8
MAN=`echo $MAN8 | sed -e 's@\(.*\)/[^/]*@\1@'`

NEWSUSER=@NEWSUSER@
NEWSGROUP=@NEWSGRP@

PFLAG="$1"
umask 0
set -x

for F in \
	${PATHNEWS}  \
	${PATHMAN} ${MAN} ${MAN1} ${MAN3} ${MAN5} ${MAN8} \
	${PATHBIN} ${PATHETC} ${PATHCONTROL} ${PATHFILTER} \
	${PATHRUN} ${PATHDB} ${PATHTMP} ${PATHLOCAL} \
	${PATHSPOOL} ${PATHARTICLES} ${PATHOVERVIEW} ${PATHARCHIVE} \
	${PATHINCOMING} ${PATHOUTGOING} ${PATHINCOMING}/bad \
	${PATHLOG} ${PATHLOG}/OLD ${PATHBIN}/rnews.libexec ${PATHBIN}/auth ; do
    if [ ! -d ${F} ] ; then
	mkdir ${PFLAG} ${F} || exit 1
	${CHOWN} ${NEWSUSER} ${F} || exit 1
	chgrp ${NEWSGROUP} ${F} || exit 1
	case ${F} in
	${PATHRUN})
	    chmod 0770 ${F} || exit 1
	    ;;
	*)
	    chmod 0775 ${F} || exit 1
	    ;;
	esac
    fi

done

exit 0
