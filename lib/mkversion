#! /bin/sh

##  $Id$
##
##  Create version.h from INN version information.
##
##  Makefile.global contains the INN version number and extra version
##  information (if any).  This is passed to use by lib/Makefile as our
##  first and second arguments.  Generate the file named by the third
##  argument with #defines containing that information in convenient forms.

version="$1"
extra="$2"
file="$3"
string="INN $version"
if [ x"$extra" = x"CVS prerelease" ] ; then
    date=`date +%Y%m%d`
    extra="$date $extra"
fi
if [ -n "$extra" ] ; then
    string="$string ($extra)"
fi
major=`echo "$version" | cut -d. -f1`
minor=`echo "$version" | cut -d. -f2`
patch=`echo "$version" | cut -d. -f3`

cat > $file <<EOF
/* Automatically generated by mkversion, edit Makefile.global to change. */

#ifndef INN_VERSION_H
#define INN_VERSION_H 1

#define INN_VERSION_MAJOR $major
#define INN_VERSION_MINOR $minor
#define INN_VERSION_PATCH $patch
#define INN_VERSION_EXTRA "$extra"
#define INN_VERSION_STRING "$string"

#endif /* INN_VERSION_H */
EOF
