.\" $Revision$
.TH BUFFCHAN 8
.SH NAME
buffchan \- buffered file-writing backend for InterNetNews
.SH SYNOPSIS
.B buffchan
[
.B \-b
]
[
.BI \-c " lines"
]
[
.BI \-C " seconds"
]
[
.BI \-d " directory"
]
[
.BI \-f " num_fields"
]
[
.BI \-m " map"
]
[
.BI \-p " pidfile"
]
[
.BI \-l " lines"
]
[
.BI \-L " seconds"
]
[
.B \-r
]
[
.BI \-s " filename_format"
]
[
.B \-u
]
.SH DESCRIPTION
.I Buffchan
reads lines from standard input and copies certain fields in
each line into files named by other fields within the line.
.I Buffchan
is intended to be called by
.IR innd (8)
as an exploder feed.
.SH OPTIONS
.TP
.B \-b
Once
.I buffchan
opens a file it keeps it open.
The input must therefore never specify more files than the
number of available descriptors can keep open.
If the ``\fB\-b\fP'' flag is used, the program will allocate a buffer and
attach it to the file using
.IR setbuf (3).
.TP
.B \-c lines
If the ``\fB\-c\fP'' flag is used,
.I buffchan
will close, and re-open, a file after every
.I lines
lines are written to a file.
.TP
.B \-C seconds
Similarly, the ``\fB\-C\fP'' flag may be used to specify that all files should
be closed and re-opened every
.I seconds
seconds.
.TP
.B \-d directory
The ``\fB\-d\fP'' flag may be used to specify a directory the program should
change to before starting.
If this flag is used, then the default for the ``\fB\-s\fP'' flag is changed to
be a simple ``%s''.
.TP
.B \-f num_fields
Buffchan
input is interpreted as a sequence of lines.
Each line contains a fixed number of initial fields, followed by a
variable number of filename fields.
All fields in a line are separated by whitespace.
The default number of initial fields is one; the ``\fB\-f\fP''
flag may be
used to specify a different number of fields.
.TP
.B \-m map
Map files specify short names as aliases for domain names; see
.IR filechan (8)
for details and an example.
.TP
.B \-p pidfile
If the ``\fB\-p\fP'' flag is used, the program will write a line containing
its process ID (in text) to the specified file.
.TP
.B \-l lines
If the ``\fB\-l\fP'' flag is used,
.I buffchan
will call
.IR fflush (3)
after every
.I lines
lines are written to a file.
.TP
.B \-L seconds
If the ``\fB\-L\fP'' flag is used,
all files will be flushed every
.I n
seconds.
.TP
.B \-r
By default, the program sends its error messages to
.IR <pathlog\ in\ inn.conf>/errlog .
To suppress this redirection and send error messages to standard error,
use the ``\fB\-r\fP'' flag.
.TP
.B \-s filename_format
After the initial fields, each remaining field names a file to
write.
The ``\fB\-s\fP'' flag may be used to specify a format string that maps
the field to a file name.
This is a
.IR sprintf (3)
format string which should have a single ``%s'' parameter which will be given
the contents of a non-initial field.
The default value is
.IR <pathoutgoing\ in\ inn.conf>/%s .
See the description of this flag in
.IR filechan (8).
.TP
.B \-u
If the ``\fB\-u\fP'' flag is used, the program will request unbuffered output.
.PP
.I Buffchan
can be invoked as an exploder feed (see
.IR newsfeeds (5)).
As such, if a line starts with an exclamation point it will be treated
as a command.
There are three commands, described below:
.TP
.B flush
The ``flush'' command closes and re-opens
all open files; ``flush\ xxx'' which flushes only the specified site.
These are analogous to the
.IR ctlinnd (8)
\&``flush'' command, 
and can be achieved by doing a ``send\ "flush\ xxx"'' command.
Applications can tell that the ``flush'' has completed by renaming the
file before issuing the command;
.I buffchan
has completed the command when the original filename re-appears.
If
.I <$ac_cv_func_fchmod in config.cache>
is ``yes'', then 
.I buffchan
also changes the access permissions of the file from read-only for
everyone to read-write for owner and group as it flushes or closes each
output file.  It will change the modes back to read-only if it re-opens
the same file.
.TP
.B drop
The ``drop'' command is similar to the ``flush'' command except that no
files are re-opened.
If given an argument, then the specified site is dropped, otherwise all
sites are dropped.
(Note that the site will be restarted if the input stream mentions the
site.)
When a
.I ctlinnd
\&``drop site'' command is sent,
.I innd
will automatically forward the command to
.I buffchan
for sites listed as funnels feeding into this exploder.
To drop all sites, use the
.I ctlinnd
\&``send buffchan-site drop'' command.
.TP
.B readmap
The map file (specified with the ``\-m'' flag) is reloaded.
.SH HISTORY
Written by Rich $alz <rsalz@uunet.uu.net> for InterNetNews.
.de R$
This is revision \\$3, dated \\$4.
..
.R$ $Id$
.SH "SEE ALSO"
ctlinnd(8),
filechan(8),
inn.conf(5),
innd(8),
newsfeeds(5).
