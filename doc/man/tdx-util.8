.\" Automatically generated by Pod::Man v1.37, Pod::Parser v1.32
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sh \" Subsection heading
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.Sh), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.if \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.\"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.hy 0
.if n .na
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "TDX-UTIL 8"
.TH TDX-UTIL 8 "2008-04-06" "INN 2.4.6" "InterNetNews Documentation"
.SH "NAME"
tdx\-util \- Tradindexed overview manipulation utility
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
\&\fBtdx-util\fR [\fB\-AFgio\fR] [\fB\-a\fR \fIarticle\fR] [\fB\-n\fR \fInewsgroup\fR]
[\fB\-p\fR \fIpath\fR] [\fB\-R\fR \fIpath\fR]
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
\&\fBtdx-util\fR is an administrative interface to the tradindexed overview
method for \s-1INN\s0.  It only works on tradindexed overview databases, not on
any other type of \s-1INN\s0 overview.  It allows the administrator to dump
various information about the internal state of the overview, audit it for
errors, and rebuild portions of the overview database.
.PP
The tradindexed overview method should lock properly and therefore it
should be safe to run this utility and perform any operation it performs,
including full repairs or per-group overview rebuilds, while the server is
running.  However, note that some of the operations performed by this
utility can take an extended period of time and will hold locks in the
overview database during that period, which depending on what the server
is doing may cause the server to stall until \fBtdx-util\fR completes its
operation.
.PP
The dump operations are \fB\-i\fR, which dumps the master index for the
overview database, \fB\-g\fR, which dumps the index for an individual group,
and \fB\-o\fR, which dumps the overview information for a particular group
(including the additional metadata stored in the index).  For \fB\-g\fR and
\&\fB\-o\fR, the \fB\-n\fR option must also be given to specify a newsgroup to
operate on.
.PP
To audit the entire overview database for problems, use \fB\-A\fR.  Any
problems found will be reported to standard error.  There is not (yet) a
corresponding option to correct the errors found.
.PP
To rebuild the database for a particular newsgroup, use \fB\-R\fR.  The \fB\-R\fR
option takes a path to a directory which contains all of the articles for
that newsgroup, one per file.  The names of the files must be the numbers
of the articles in that group.  (In other words, this directory must be a
traditional spool directory for that group.)  The \fB\-n\fR option must also
be given to specify the newsgroup for which the overview is being rebuilt.
.PP
For all operations performed by \fBtdx-util\fR, a different overview database
than the one specified in \fIinn.conf\fR may be specified using the \fB\-p\fR
option.
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\fB\-A\fR" 4
.IX Item "-A"
Audit the entire overview database for problems.  This runs the internal
consistency checks built into the tradindexed overview implementation,
checking such things as the validity and reachability of all group index
entries, the format of the individual overview entries, the correspondance
of index entries to overview data, and similar such things.  No changes
will be made to the database, but problems will be reported to standard
error.
.IP "\fB\-a\fR \fIarticle\fR" 4
.IX Item "-a article"
The article number to act on.  Only useful in combination with the \fB\-o\fR
option to dump overview information.
.IP "\fB\-F\fR" 4
.IX Item "-F"
Audit the entire overview database for problems, fixing them as they're
detected where possible. This runs the internal consistency checks built
into the tradindexed overview implementation, checking such things as the
validity and reachability of all group index entries, the format of the
individual overview entries, the correspondance of index entries to
overview data, and similar such things.  The strategy used when fixing
problems is to throw away data that's unrecoverable, so be warned that
using this option may result in inaccessible articles if their overview
data has been corrupted.
.Sp
To see what would be changed by \fB\-F\fR, run \fBtdx-util\fR with \fB\-A\fR first.
.IP "\fB\-g\fR" 4
.IX Item "-g"
Dump the master index of the overview database.  This contains similar
information to the server active file, such as high and low water marks
and moderation status, and is the information that nnrpd hands out to
clients.
.Sp
The fields are, in order, the newsgroup name, the high water mark, the low
water mark, the base article number (the point at which the group index
begins), the count of articles in the group, the group status flag, the
time (in seconds since epoch) when that newsgroup was deleted or 0 if it
hasn't been, and the inode of the index file for that group.
.IP "\fB\-i\fR" 4
.IX Item "-i"
Dump the index of a particular group.  The fields are, in order, the
article number, the offset of the data for that article in the overview
data file for that group, the length of the overview data, the time (in
seconds since epoch) when the article arrived on the server, the time (in
seconds since epoch) when the article should expire based on its Expires
header (or 0 if there is no Expires header), and the storage \s-1API\s0 token of
the article.
.Sp
If this option is given, the \fB\-n\fR option must also be given to specify
the newsgroup on which to act.
.IP "\fB\-n\fR \fInewsgroup\fR" 4
.IX Item "-n newsgroup"
Specify the newsgroup on which to act, required for the \fB\-i\fR, \fB\-o\fR, and
\&\fB\-R\fR options.
.IP "\fB\-o\fR" 4
.IX Item "-o"
Dump the overview information for a newsgroup, in the same format as it
would be returned to clients but with one modification.  Appended to the
end of each entry will be four additional pieces of data:  the article
number according to the index file for that group, the storage \s-1API\s0 token
for that article, the arrival date for that article on the server in \s-1RFC\s0
822 date format, and the expiration date for that article (from the
Expires header) in \s-1RFC\s0 822 date format if there is any.
.Sp
If this option is given, the \fB\-n\fR option must also be given to specify
the newsgroup on which to act.  By default, all of the overview
information for that newsgroup is dumped, but the \fB\-a\fR option may be
given to restrict the dump to the information for a single article.
.IP "\fB\-p\fR \fIpath\fR" 4
.IX Item "-p path"
Act on the overview database rooted in \fIpath\fR, overriding the overview
path specified in \fIinn.conf\fR.
.IP "\fB\-R\fR \fIpath\fR" 4
.IX Item "-R path"
Rebuild the overview for a given group from the articles stored in
\&\fIpath\fR.  The articles must be in the form of a traditional spool
directory; in other words, each article must be in a separate file and the
name of the file must match the article number of the article.
.Sp
If this option is given, the \fB\-n\fR option must also be given to specify
the newsgroup on which to act.
.SH "EXAMPLES"
.IX Header "EXAMPLES"
Dump the master index for the overview database in \fI/news/overview\fR,
regardless of the overview path specified in \fIinn.conf\fR:
.PP
.Vb 1
\&    tdx\-util \-i \-p /news/overview
.Ve
.PP
Dump the group index for example.test:
.PP
.Vb 1
\&    tdx\-util \-g \-n example.test
.Ve
.PP
Dump the complete overview information for example.test:
.PP
.Vb 1
\&    tdx\-util \-o \-n example.test
.Ve
.PP
Audit the entire overview database for any problems:
.PP
.Vb 1
\&    tdx\-util \-A
.Ve
.PP
Rebuild the overview information for example.test from a traditional spool
directory:
.PP
.Vb 1
\&    tdx\-util \-R /news/spool/articles/example/test \-n example.test
.Ve
.PP
The last command may be useful for recovering from a bad crash or
corrupted overview information for a particular group, if you are also
using the tradspool article storage method.
.SH "HISTORY"
.IX Header "HISTORY"
Written by Russ Allbery <rra@stanford.edu> for InterNetNews.
.PP
$Id$
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fImakehistory\fR\|(8)
