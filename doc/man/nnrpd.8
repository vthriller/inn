.\" $Revision$
.TH NNRPD 8
.SH NAME
nnrpd \- NNTP server for on-campus hosts
.SH SYNOPSIS
.B nnrpd
[
.BI \-b " address"
]
[
.B \-D
]
[
.BI \-g " shadowgroup"
]
[
.B \-i
]
[
.B \-o
]
[
.BI \-p " port"
]
[
.B \-R
]
[
.BI \-r " reason"
]
[
.B \-S
]
[
.BI \-s " title padding"
]
[
.B \-t
]
.SH DESCRIPTION
.I Nnrpd
is an NNTP server for newsreaders.
It accepts commands on its standard input and responds on its standard output.
It is normally invoked by
.IR innd (8)
with those descriptors attached to a remote client connection. 
.I Nnrpd 
also supports running as a standalone daemon.
.PP
Unlike
.IR innd ,
.I nnrpd
supports all NNTP commands for user-oriented reading and posting.
.PP
.I Nnrpd
uses the
.IR readers.conf (5)
file to control who is authorized to access the Usenet database.
When
.I <NNRP_LOADLIMIT in include/config.h>
is not 0, It will also reject connections if the load average is greater than
that value
(typically
.IR 16 .) 
.PP
On exit,
.I nnrpd
will report usage statistics through
.IR syslog (3).
.PP
.I Nnrpd
can also prevent high-volume posters from abusing your resources. See the
discussion of exponential backoff in 
.IR inn.conf (5).
.SH OPTIONS
.TP
.B \-b
The ``\-b'' parameter instructs
.I nnrpd
to bind to the specified
.I IP address
when started as a standalone daemon using the ``\-D'' flag. 
This has to be a valid Internet
address in dotted-quad format belonging to an interface of the local
host.
.TP
.B \-D
If specified, this parameter causes 
.I nnrpd
to operate as a daemon. That is, it detaches itself and runs in the
background, forking a process for every connection. By default
.I nnrpd
listens on the NNTP port (119), so either
.I innd
has to be started on another port or
.I nnrpd
is invoked with the ``\-p'' parameter.
.TP
.B \-g
On systems that have a shadow password file,
.I nnrpd
tries to add the group ``shadow'' as a supplementary group if it is
running in standalone mode. On many systems, members of that group have
read permission for the shadow password file.
The ``\-g'' parameter instructs
.I nnrpd
to try to add the named group as a supplementary group on shadow systems
instead of ``shadow''.
This only works if
.I <HAVE_GETSPNAM inn include/config.h>
is defined and
.I nnrpd
is running in standalone mode since this call only works when
.I nnrpd
is started as root.
.TP
.B \-o
The ``\-o'' flag causes all articles to be spooled instead of sending
them to
.IR innd .
.I Rnews
with ``-U'' flag should be invoked from cron on a regular basis to take care of
these articles. This flag is useful if
.I innd
in accepting articles and
.I nnrpd
is started standalone or using 
.IR inetd .
.TP
.B \-p
The ``\-p'' parameter instructs
.I nnrpd
to listen on
.IR port 
when started as a standalone daemon using the ``\-D'' flag.
.TP
.B \-R
This option forces
.I nnrpd
to be ``read-only''.
The startup banner will indicate ``no posting''.
.TP
.B \-r
If the ``\-r'' flag is used, then
.I nnrpd
will reject the incoming connection giving
.I reason
as the text.
This flag is used by
.I innd
when it is paused or throttled.
.TP
.B \-S
If specified, 
.I nnrpd
start a negotiation for SSL session as soon as connected.
To use this flag,
.I <--with-openssl at configure>
must be specified.
.TP
.B \-s
As each command is received,
.I nnrpd
tries to change its ``argv'' array so that
.IR ps (1)
will print out the command being executed.
To get a full display, the ``\-s'' flag may be used with a long string
as its argument, which will be overwritten when the program changes
its title.
.TP
.B \-t
If the ``\-t'' flag is used then all client commands and initial responses
will be traced by reporting them in
.IR syslog .
This flag is set by
.I innd
under the control of the
.IR ctlinnd (8)
\&``trace'' command, and is toggled upon receipt of a SIGHUP; see
.IR signal (2).
.SH "PROTOCOL DIFFERENCES"
.I Nnrpd
implements the NNTP commands defined in RFC 977, with the following
differences:
.IP 1.
The
.I "``ihave''"
command is not implemented.
Users should be using the
.I "``post''"
command to post articles.
.IP 2
The
.I "``slave''"
command is not implemented.
This command has never been fully defined.
.IP 3
The
.I "``list''"
command may be followed by the optional word
``\fIactive.times\fP'',
``\fIdistributions\fP'',
``\fIdistrib.pats\fP'',
``\fImoderators\fP'',
``\fInewsgroups\fP'',
``\fIsubscriptions\fP'',
or
``\fIoverview.fmt\fP''
to get a list of when newsgroups where created, a list of valid distributions,
a file specifying default distribution patterns, moderators list, a one-per-line
description of the current set of newsgroups, a list of the automatic group
subscriptions, or a listing of the
.IR overview.fmt (5)
file.
The command
.I "``list active''"
is equivalent to the
.I "``list''"
command.
This is a common extension.
.IP 4.
The
.IR ``xhdr'' ,
.IR "``authinfo user''" ,
and
.I "``authinfo pass''"
commands are implemented.
These are based on the reference Unix implementation. See
ftp://ftp.ietf.org/internet-drafts/draft-ietf-nntpext-imp-04.txt
.IP 5.
A new command,
.IR "``xpat header range|MessageID pat [morepat...]''" ,
is provided.
The first argument is the case-insensitive name of the header to be
searched.
The second argument is either an article range or a single Message-ID,
as specified in RFC 977.
The third argument is a
.IR wildmat (3)-style
pattern; if there are additional arguments they are joined together separated
by a single space to form the complete pattern.
This command is similar to the
.I "``xhdr''"
command.
It returns a
.I 221
response code, followed by the text response of all article numbers
that match the pattern.
.IP 6.
The
.I "``listgroup group''"
command is provided.
This is a comment extension.
It is equivalent to the
.I "``group''"
command, except that the reply is a multi-line response containing the
list of all article numbers in the group.
.IP 7.
The
.I "``xgtitle [group]''"
command is provided.
This extension is used by ANU-News.
It returns a
.I 282
reply code, followed by a one-line description of all newsgroups that
match the pattern.
The default is the current group.
.IP 8.
The
.I "``xover [range]''"
command is provided.
It returns a
.I 224
reply code, followed by the overview data for the specified range; the
default is to return the data for the current article.
.IP 9.
The
.I "``xpath MessageID''"
command is provided; see
.IR innd (8).
.IP 10.
The
.I "``date''"
command is provided; this is based on the draft NNTP protocol revision(
draft-ietf-nntpext-imp-04.txt).
It returns a one-line response code of
.I 111
followed by the GMT date
and time on the server in the form YYYYMMDDhhmmss.
.SH HISTORY
Written by Rich $alz <rsalz@uunet.uu.net> for InterNetNews.
Overview support added by Rob Robertston <rob@violet.berkeley.edu> and
Rich in January, 1993. Exponential backoff (for posting) added by
Dave Hayes in Febuary 1998.
.de R$
This is revision \\$3, dated \\$4.
..
.R$ $Id$
.SH "SEE ALSO"
ctlinnd(8), innd(8), inn.conf(5), signal(2), wildmat(3).
