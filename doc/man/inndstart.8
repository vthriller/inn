.\" Automatically generated by Pod::Man version 0.07
.\" Mon Sep 27 11:43:10 1999
.\"
.\" Standard preamble:
.\" ======================================================================
.de Sh \" Subsection heading
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Ip \" List item
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R

.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  | will give a
.\" real vertical bar.  \*(C+ will give a nicer C++.  Capital omega is used
.\" to do unbreakable dashes and therefore won't be available.  \*(C` and
.\" \*(C' expand to `' in nroff, nothing in troff, for use with C<>
.tr \(*W-|\(bv\*(Tr
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` `
.    ds C' '
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" If the F register is turned on, we'll generate index entries on stderr
.\" for titles (.TH), headers (.SH), subsections (.Sh), items (.Ip), and
.\" index entries marked with X<> in POD.  Of course, you'll have to process
.\" the output yourself in some meaningful fashion.
.if \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
.    .
.    nr % 0
.    rr F
.\}
.\"
.\" For nroff, turn off justification.  Always turn off hyphenation; it
.\" makes way too many mistakes in technical documents.
.hy 0
.if n .na
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.bd B 3
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ======================================================================
.\"
.IX Title "inndstart 8"
.TH inndstart 8 "INN 2.3" "1999-9-27" "InterNetNews Documentation"
.UC
.SH "NAME"
inndstart \- Start innd
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
\fBinndstart\fR [\fB\-P\fR \fIport\fR] [\fB\-I\fR \fIaddress\fR] [\fIinnd-options\fR]
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
The purpose of \fBinndstart\fR is to raise system file descriptor limits,
open the privileged news transfer port, and then start \fIinnd\fR\|(8), passing it
the open file descriptor for the news port.  \fBinndstart\fR is used since
only privileged programs can perform those two operations and since
\fBinnd\fR should not run privileged.  It is installed setuid root and drops
privileges to the news user (set at configure time) before running
\fBinnd\fR.
.PP
Normally there is no need to run \fBinndstart\fR directly.  Instead, run
\fIrc.news\fR\|(8) as the news user, and it will handle running \fBinndstart\fR
appropriately for you.
.PP
Since \fBinndstart\fR is setuid root, it is extremely restrictive about who
can run it and what it is willing to do.  See the section on "SECURITY" for the full
details.
.PP
\fBinndstart\fR can only be run by the news user; if run by any other user,
it will abort.  It will also only bind to ports 119, 433, or a port number
given at configure time with \fB\*(--with-innd-port\fR among those ports below
1024, although it can bind to any port above 1024.  This is to prevent
various security exploits possible by binding to arbitrary privileged
ports.
.PP
Before running \fBinnd\fR, \fBinndstart\fR cleans out the environment and sets
only those environment variables listed in the section on "ENVIRONMENT".
.SH "OPTIONS"
.IX Header "OPTIONS"
.Ip "\fB\-P\fR \fIport\fR" 4
.IX Item "-P port"
Bind to \fIport\fR instead of whatever is specified by \fIport\fR in
\fIinn.conf\fR\|(5).  Note that this is subject to the constraints mentioned
above.
.Ip "\fB\-I\fR \fIaddress\fR" 4
.IX Item "-I address"
Bind as \fIaddress\fR instead of whatever is specified by \fIbindaddress\fR in
\fIinn.conf\fR\|(5).  The default behavior is to bind to \s-1INADDR_ANY\s0, and that's
what's desired almost all the time.  This option, and the \fIinn.conf\fR\|(5)
parameter, may be useful if the machine has multiple interface cards and
\fBinnd\fR should only be listening on a particular one.
.PP
All other options given on the command line are passed verbatim to
\fBinnd\fR.  In addition, \fBinndstart\fR will give the \fB\-p\fR option to \fBinnd\fR,
specifying the file descriptor of the open network socket.
.SH "SECURITY"
.IX Header "SECURITY"
\fBinndstart\fR is setuid root, and therefore an expected point of attack.
It has therefore been carefully written with security in mind.  In a
normal \s-1INN\s0 installation, it is installed setuid root and executable only
by users in the news group.
.PP
Ideally, everything about \fBinndstart\fR's operations would be hard-coded so
that it could not be modified.  Fighting against this desire, however, is
the ideal that as much of \s-1INN\s0's operation as possible should be
configurable at run-time using \fIinn.conf\fR\|(5), and the news system should be
able to an alternate inn.conf by setting \s-1INNCONF\s0 to the path to that file
before starting any programs.  The configuration data therefore can't be
trusted.
.PP
The security model used is:
.Ip "\(bu" 2
\fBinndstart\fR can only be executed by the news user and news group, as
determined at configure time and compiled into \fBinndstart\fR as constants.
Similarly, \fBinndstart\fR will always \fIsetuid()\fR and \fIsetgid()\fR to those users
before running \fBinnd\fR.  This is to prevent a user other than news but in
the news group from using \fBinndstart\fR to leverage that access into access
to the news account.
.Ip "\(bu" 2
As mentioned above, \fBinndstart\fR will only bind to a very limited set of
ports below 1024.  There are various attacks that can be performed using
random low-numbered ports, including exploits of the rsh family of
commands on some systems.
.Ip "\(bu" 2
\fBinndstart\fR does as little as possible as root, dropping privileges
before performing any operations that do not require elevated privileges.
.PP
This program therefore gives the news user the ability to revoke system
file descriptor limits and bind to the news port, and nothing else.
.SH "DIAGNOSTICS"
.IX Header "DIAGNOSTICS"
\fBinndstart\fR may log the following messages to syslog (like the rest of
\s-1INN\s0, syslog is the best place to find detailed debugging information):
.Ip "can't bind: \f(CW%s\fR" 4
.IX Item "can't bind: %s"
(Fatal) Unable to bind to the designated port.  This usually means that
something else is already running on the news port.  Check with
\fInetstat\fR\|(8) and make sure that \fIinetd\fR\|(8) doesn't think it's running a
service on the same port you're trying to run \fBinnd\fR on.
.Ip "can't exec \f(CW%s:\fR \f(CW%s\fR" 4
.IX Item "can't exec %s: %s"
(Fatal) \fBinndstart\fR was unable to execute \fBinnd\fR.  Make sure that
\fIpathbin\fR is set correctly in inn.conf and that \fBinnd\fR is located in
that directory and is executable by the news user.
.Ip "can't getrlimit(\s-1NOFILE\s0)" 4
.IX Item "can't getrlimit(NOFILE)"
(Warning) Unable to obtain the current system resource limit on file
descriptors.  Chances are something is wrong with the *\fIrlimit()\fR
functions.  The file descriptor limit was left unchanged from the system
default.
.Ip "can't open socket: \f(CW%s\fR" 4
.IX Item "can't open socket: %s"
(Fatal) Something went wrong in creating the network socket.  Chances are
your system is out of resources of some kind.
.Ip "can't setgid(%d): \f(CW%s\fR" 4
.IX Item "can't setgid(%d): %s"
(Fatal) Dropping privileges to the news group failed for some reason.
.Ip "can't setgroups: \f(CW%s\fR" 4
.IX Item "can't setgroups: %s"
(Warning) Dropping all supplemental groups except the news group failed
for some reason, and the process group membership was left unchanged.
This message may indicate a minor security hole if the news user is in
extra groups.
.Ip "can't setrlimit(\s-1NOFILE\s0, \f(CW%d\fR)" 4
.IX Item "can't setrlimit(NOFILE, %d)"
(Warning) Unable to set the system file descriptor limit to the specified
value.  Either that value is too high for your system or something else
went wrong.  The file descriptor limit was left unchanged.  Try changing
\fIrlimitnofile\fR in inn.conf to a smaller value.
.Ip "can't setsockopt: \f(CW%s\fR" 4
.IX Item "can't setsockopt: %s"
(Warning) \fBinndstart\fR attempts to set \s-1SO_REUSEADDR\s0 so that if \fBinnd\fR
exits, it can be restarted again immediately without waiting for the port
to time out.  For some reason, this failed, and that option was not set on
the port.
.Ip "can't setuid(%d): \f(CW%s\fR" 4
.IX Item "can't setuid(%d): %s"
(Fatal) Dropping privileges to the news user failed for some reason.
.Ip "can't stat pathrun (%s): \f(CW%s\fR" 4
.IX Item "can't stat pathrun (%s): %s"
(Fatal) \fIpathrun\fR as specified in inn.conf doesn't exist.
.Ip "getgrnam(%s) failed" 4
.IX Item "getgrnam(%s) failed"
(Fatal) Unable to determine the \s-1GID\s0 for the compiled-in news group.  Is
the news group listed in /etc/group?
.Ip "getpwnam(%s) failed" 4
.IX Item "getpwnam(%s) failed"
(Fatal) Unable to determine the \s-1UID\s0 for the compiled-in news user.  Is the
news user listed in /etc/passwd?
.Ip "invalid address \f(CW%s\fR" 4
.IX Item "invalid address %s"
(Fatal) \fB\-I\fR was specified on the command line, but the argument wasn't a
valid address.  Addresses must be given as numeric \s-1IP\s0 addresses.
.Ip "invalid bindaddress in inn.conf (%s)" 4
.IX Item "invalid bindaddress in inn.conf (%s)"
(Fatal) The \fIbindaddress\fR specified in inn.conf could not be converted to
an \s-1IP\s0 address.  See \fIinn.conf\fR\|(5) for more information about valid values.
.Ip "invalid port \f(CW%s\fR" 4
.IX Item "invalid port %s"
(Fatal) \fB\-P\fR was specified on the command line, but the argument wasn't a
valid port.  Ports must be port numbers; service names are not allowed.
.Ip "missing address after \-I" 4
.IX Item "missing address after -I"
(Fatal) \fB\-I\fR was given on the command line, but no address was given
after the option.
.Ip "missing port after \-P" 4
.IX Item "missing port after -P"
(Fatal) \fB\-P\fR was given on the command line, but no port was given after
the option.
.Ip "pathrun (%s) not a directory" 4
.IX Item "pathrun (%s) not a directory"
(Fatal) \fIpathrun\fR as specified in inn.conf isn't a directory.  This is
where \fBinnd\fR will create its local control socket; it should always be a
directory.
.Ip "pathrun (%s) owned by group \f(CW%d\fR, not \f(CW%s\fR (%d)" 4
.IX Item "pathrun (%s) owned by group %d, not %s (%d)"
(Fatal) \fIpathrun\fR specified in inn.conf must be owned by the news group.
This is checked for security reasons.
.Ip "pathrun (%s) owned by user \f(CW%d\fR, not \f(CW%s\fR (%d)" 4
.IX Item "pathrun (%s) owned by user %d, not %s (%d)"
(Fatal) \fIpathrun\fR specified in inn.conf must be owned by the news user.
This is checked for security reasons.
.Ip "ran by \s-1GID\s0 \f(CW%d\fR, who isn't \f(CW%s\fR (%d)" 4
.IX Item "ran by GID %d, who isn't %s (%d)"
(Fatal) Someone not in the news group attempted to run \fBinndstart\fR.  If
you were running \fBinndstart\fR as the news user, make sure that the news
user's default group is the news group you picked at compile time (\f(CW\*(C`news\*(C'\fR
by default).
.Ip "ran by \s-1UID\s0 \f(CW%d\fR, who isn't \f(CW%s\fR (%d)" 4
.IX Item "ran by UID %d, who isn't %s (%d)"
(Fatal) Someone other than the news user attempted to run \fBinndstart\fR.
\fBinndstart\fR may only be run by the news user for security reasons.
.Ip "setregid(%d, \f(CW%d\fR) failed" 4
.IX Item "setregid(%d, %d) failed"
(Fatal) Unable to change the real and effective GIDs.  This message
usually means that \fBinndstart\fR was installed with the wrong permissions.
.Ip "setreuid(%d, \f(CW%d\fR) failed" 4
.IX Item "setreuid(%d, %d) failed"
(Fatal) Unable to change the real and effective UIDs.  This message
usually means that \fBinndstart\fR was installed with the wrong permissions.
.Ip "tried to bind to port \f(CW%d\fR" 4
.IX Item "tried to bind to port %d"
(Fatal) \fBinndstart\fR was told to bind to a low numbered port (under 1024)
other than 119, 433, or a port number given at configure time.  This is
not allowed for security reasons.
.SH "EXAMPLES"
.IX Header "EXAMPLES"
Normally, \fBinndstart\fR is never run directly.  However, a simple way to
just restart \fBinnd\fR without running any other auxilliary programs or
performing any of the other checks done by \fIrc.news\fR\|(8) is to just run:
.PP
.Vb 1
\&    inndstart
.Ve
as the news user.
.PP
To start \fBinnd\fR on port 433, passing it the \f(CW\*(C`\-c21\*(C'\fR option, use:
.PP
.Vb 1
\&    inndstart -P433 -c21
.Ve
.SH "ENVIRONMENT"
.IX Header "ENVIRONMENT"
One environment variable affects the operation of \fBinndstart\fR itself:
.Ip "\s-1INNCONF\s0" 8
.IX Item "INNCONF"
The full path to the \fIinn.conf\fR\|(5) file to read, rather than the default.
This can be used to run multiple copies of \s-1INN\s0 on the same machine with
different settings.
.PP
When executing \fBinnd\fR, \fBinndstart\fR cleans out the entire environmnent
and sets only the following variables:
.Ip "\s-1BIND_INADDR\s0" 8
.IX Item "BIND_INADDR"
Passed verbatim from \fBinndstart\fR's environment.  This is apparently used
on Linux.
.Ip "\s-1HOME\s0" 8
.IX Item "HOME"
Set to \fIpathnews\fR from inn.conf.
.Ip "\s-1LOGNAME\s0" 8
.IX Item "LOGNAME"
Set to the news master, as determined at configure time.
.Ip "\s-1PATH\s0" 8
.IX Item "PATH"
Set to \fIpathbin\fR from inn.conf, \fIpathetc\fR from inn.conf, and then /bin,
/usr/bin, and /usr/ucb in that order.
.Ip "\s-1SHELL\s0" 8
.IX Item "SHELL"
Set to the path to the system Bourne shell as determined by configure
(probably /bin/sh).
.Ip "\s-1TMPDIR\s0" 8
.IX Item "TMPDIR"
Set to \fIpathtmp\fR from inn.conf.
.Ip "\s-1TZ\s0" 8
.IX Item "TZ"
Passed verbatim from \fBinndstart\fR's environment.
.Ip "\s-1USER\s0" 8
.IX Item "USER"
Set to the news master, as determined at configure time.
.SH "FILES"
.IX Header "FILES"
.Ip "inn.conf" 4
.IX Item "inn.conf"
Read for \fIpathnews\fR, \fIpathbin\fR, \fIpathrun\fR, \fIpathtmp\fR, \fIrlimitnofile\fR,
\fIbindaddress\fR, and \fIport\fR.
.Ip "\fIpathbin\fR/innd" 4
.IX Item "pathbin/innd"
The binary that is executed as \fBinnd\fR and passed the open network socket.
.Ip "\fIpathrun\fR" 4
.IX Item "pathrun"
Checked for existence and the right ownership.
.SH "HISTORY"
.IX Header "HISTORY"
Written by Russ Allbery <rra@stanford.edu> for InterNetNews.
.PP
$Id$
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\fIinn.conf\fR\|(5), \fIinnd\fR\|(8)
