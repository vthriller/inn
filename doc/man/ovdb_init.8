.rn '' }`
''' $RCSfile$$Revision$$Date$
'''
''' $Log$
''' Revision 1.1  2000/08/29 22:03:57  kondou
''' - From: Heath Kehoe <heath.kehoe@intermec.com>
''' - new ovdb version (forgot to commit last time)
'''
'''
.de Sh
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp
.if t .sp .5v
.if n .sp
..
.de Ip
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.de Vb
.ft CW
.nf
.ne \\$1
..
.de Ve
.ft R

.fi
..
'''
'''
'''     Set up \*(-- to give an unbreakable dash;
'''     string Tr holds user defined translation string.
'''     Bell System Logo is used as a dummy character.
'''
.tr \(*W-|\(bv\*(Tr
.ie n \{\
.ds -- \(*W-
.ds PI pi
.if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\" diablo 12 pitch
.ds L" ""
.ds R" ""
'''   \*(M", \*(S", \*(N" and \*(T" are the equivalent of
'''   \*(L" and \*(R", except that they are used on ".xx" lines,
'''   such as .IP and .SH, which do another additional levels of
'''   double-quote interpretation
.ds M" """
.ds S" """
.ds N" """""
.ds T" """""
.ds L' '
.ds R' '
.ds M' '
.ds S' '
.ds N' '
.ds T' '
'br\}
.el\{\
.ds -- \(em\|
.tr \*(Tr
.ds L" ``
.ds R" ''
.ds M" ``
.ds S" ''
.ds N" ``
.ds T" ''
.ds L' `
.ds R' '
.ds M' `
.ds S' '
.ds N' `
.ds T' '
.ds PI \(*p
'br\}
.\"	If the F register is turned on, we'll generate
.\"	index entries out stderr for the following things:
.\"		TH	Title 
.\"		SH	Header
.\"		Sh	Subsection 
.\"		Ip	Item
.\"		X<>	Xref  (embedded
.\"	Of course, you have to process the output yourself
.\"	in some meaninful fashion.
.if \nF \{
.de IX
.tm Index:\\$1\t\\n%\t"\\$2"
..
.nr % 0
.rr F
.\}
.TH ovdb_init 8 "INN 2.3" "26/Aug/2000" "InterNetNews Documentation"
.UC
.if n .hy 0
.if n .na
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.de CQ          \" put $1 in typewriter font
.ft CW
'if n "\c
'if t \\&\\$1\c
'if n \\&\\$1\c
'if n \&"
\\&\\$2 \\$3 \\$4 \\$5 \\$6 \\$7
'.ft R
..
.\" @(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2
.	\" AM - accent mark definitions
.bd B 3
.	\" fudge factors for nroff and troff
.if n \{\
.	ds #H 0
.	ds #V .8m
.	ds #F .3m
.	ds #[ \f1
.	ds #] \fP
.\}
.if t \{\
.	ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.	ds #V .6m
.	ds #F 0
.	ds #[ \&
.	ds #] \&
.\}
.	\" simple accents for nroff and troff
.if n \{\
.	ds ' \&
.	ds ` \&
.	ds ^ \&
.	ds , \&
.	ds ~ ~
.	ds ? ?
.	ds ! !
.	ds /
.	ds q
.\}
.if t \{\
.	ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.	ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.	ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.	ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.	ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.	ds ? \s-2c\h'-\w'c'u*7/10'\u\h'\*(#H'\zi\d\s+2\h'\w'c'u*8/10'
.	ds ! \s-2\(or\s+2\h'-\w'\(or'u'\v'-.8m'.\v'.8m'
.	ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.	ds q o\h'-\w'o'u*8/10'\s-4\v'.4m'\z\(*i\v'-.4m'\s+4\h'\w'o'u*8/10'
.\}
.	\" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds v \\k:\h'-(\\n(.wu*9/10-\*(#H)'\v'-\*(#V'\*(#[\s-4v\s0\v'\*(#V'\h'|\\n:u'\*(#]
.ds _ \\k:\h'-(\\n(.wu*9/10-\*(#H+(\*(#F*2/3))'\v'-.4m'\z\(hy\v'.4m'\h'|\\n:u'
.ds . \\k:\h'-(\\n(.wu*8/10)'\v'\*(#V*4/10'\z.\v'-\*(#V*4/10'\h'|\\n:u'
.ds 3 \*(#[\v'.2m'\s-2\&3\s0\v'-.2m'\*(#]
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.ds oe o\h'-(\w'o'u*4/10)'e
.ds Oe O\h'-(\w'O'u*4/10)'E
.	\" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.	\" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.	ds : e
.	ds 8 ss
.	ds v \h'-1'\o'\(aa\(ga'
.	ds _ \h'-1'^
.	ds . \h'-1'.
.	ds 3 3
.	ds o a
.	ds d- d\h'-1'\(ga
.	ds D- D\h'-1'\(hy
.	ds th \o'bp'
.	ds Th \o'LP'
.	ds ae ae
.	ds Ae AE
.	ds oe oe
.	ds Oe OE
.\}
.rm #[ #] #H #V #F C
.SH "NAME"
ovdb_init \- Prepare ovdb database for use
.SH "SYNOPSYS"
ovdb_init [\f(CW-u\fR|\f(CW-r\fR]
.SH "DESCRIPTION"
This command must be run before any other process can access the
overview database.  It performs the following steps:
.Ip "1" 4
Creates the database environment, if necessary
.Ip "2" 4
If the database is idle (and if the \f(CW-u\fR option is not specified),
it performs a normal recovery.  The recovery will remove stale locks,
recreate the memory pool cache, and repair any damage caused by a system
crash or improper shutdown.
.Ip "3" 4
If the \f(CW-u\fR option is specified, it performs any necessary upgrades
to the database.  See the \s-1UPGRADING\s0 section below.
.Ip "4" 4
Starts the \s-1DB\s0 housekeeping processes (ovdb_monitor) if they're not
already running. (Unless the \f(CW-r\fR option is specified).
.PP
Returns exit status of 0 if all steps were completed successfully.
In the event of an error, messages are written to syslog and/or stderr.
.PP
If a recovery was attempted but it failed, the database may be
damaged beyond repair, requiring a rebuild with \fImakehistory\fR\|(8).
.PP
This command is normally invoked automatically by rc.\fInews\fR\|(8).
.PP
It is \s-1OK\s0 to run this command multiple times.
.SH "OPTIONS"
.Ip "\f(CW-r\fR" 4
Perform recovery only.  \f(CWovdb_monitor\fR is not started.
.Ip "\f(CW-u\fR" 4
Perform any needed upgrades.  Recovery is not attempted.
\f(CWovdb_monitor\fR is started if the upgrade succeeded.
.SH "UPGRADING"
There are two situations in which the database will need to be
upgraded:
.Ip "\(bu" 4
You upgrade the BerkeleyDB library to a newer version, for example
from 2.7.7 to 3.1.17.  In this case, the BerkeleyDB db->\fIupgrade()\fR
method is used.
.Ip "\(bu" 4
You upgrade ovdb to a newer major version; i.e., ovdb-1.0 to ovdb-2.0.
.PP
In both of these cases, the database is upgraded in-place; and the
upgrade can not be undone.  Do not interrupt the upgrade process once
it has started, because there is a risk of irrepairable corruption.
The upgrade may take several minutes to complete.
If an upgrade does get interrupted, try running the upgrade again.
.PP
Here's an example procedure to upgrade a database created with BerkeleyDB
2.x to use BerkeleyDB 3.x:
.Ip "1" 4
Build and install the BerkeleyDB 3.x
.Ip "2" 4
Run configure in the \s-1INN\s0 source tree and make sure it picks up the
right BerkeleyDB directory (e.g., /usr/local/BerkeleyDB.3.1)
.Ip "3" 4
Do a \f(CWmake\fR
.Ip "4" 4
Shut down \s-1INN\s0 (e.g., with \f(CWrc.news stop\fR).  Be sure to kill all nnrpds as
well.
.Ip "5" 4
Do a \f(CWmake update\fR to install the new binaries.
.Ip "6" 4
Run \f(CWovdb_init -u\fR as the news user.
.Ip "7" 4
Start \s-1INN\s0 with \f(CWrc.news\fR
.PP
It is \s-1OK\s0 to specify \f(CW-u\fR even if no upgrades are needed.
.SH "WARNINGS"
Always run this command as the news user, and never as root.
.SH "HISTORY"
Written by Heath Kehoe <hakehoe@avalon.net> for InterNetNews.
.SH "SEE ALSO"
\fIovdb\fR\|(5), \fImakehistory\fR\|(8)

.rn }` ''
.IX Title "ovdb_init 8"
.IX Name "ovdb_init - Prepare ovdb database for use"

.IX Header "NAME"

.IX Header "SYNOPSYS"

.IX Header "DESCRIPTION"

.IX Item "1"

.IX Item "2"

.IX Item "3"

.IX Item "4"

.IX Header "OPTIONS"

.IX Item "\f(CW-r\fR"

.IX Item "\f(CW-u\fR"

.IX Header "UPGRADING"

.IX Item "\(bu"

.IX Item "\(bu"

.IX Item "1"

.IX Item "2"

.IX Item "3"

.IX Item "4"

.IX Item "5"

.IX Item "6"

.IX Item "7"

.IX Header "WARNINGS"

.IX Header "HISTORY"

.IX Header "SEE ALSO"

