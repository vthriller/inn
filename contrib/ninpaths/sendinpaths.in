#!/bin/sh
# fixscript will replace this line with code to load innshellvars
#
# Submit path statistics based on ninpaths
# $Id$

# Assuming the ninpaths dump files are in ${MOST_LOGS}/path/inpaths.%d

cd ${MOST_LOGS}/path
ME=`${NEWSBIN}/innconfval pathhost`
report=30
keep=14
TMP=""
defaddr="pathsurvey@top1000.org top1000@anthologeek.net"

# Make report from (up to) $report days of dumps
LOGS=`find . -name 'inpaths.*' ! -size 0 -mtime -$report -print`

# for check dumps
for i in $LOGS
do
 ninpaths -u $i -r $ME > /dev/null 2>&1
 if test $? -eq 0; then :
  TMP="$TMP -u $i"
 fi
done

if [ "$1" = "-n" ] ; then
  ninpaths $TMP -r $ME
else
  ninpaths $TMP -r $ME |\
   $MAILCMD -s "inpaths $ME" ${1:-$defaddr}
  # remove dumps older than $keep days
  find . -name 'inpaths.*' -mtime +$keep -exec rm '{}' \;
fi

exit 0
